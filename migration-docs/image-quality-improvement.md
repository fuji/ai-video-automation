# 画像生成クオリティ改善計画

**作成日:** 2026-01-26
**更新日:** 2026-01-26
**ステータス:** 要件定義中

---

## 背景・課題

### 現状の問題点
- ニュース記事から動画生成しているが、画像がちゃちい
- 例：日本の事案なのに、日本地図をズームしてるだけの動画
- 解像度、リアリティが不足

### 現状のアーキテクチャ
```
ニュース記事 → Gemini(プロンプト生成) → Gemini(画像生成) → KLING(動画生成)
```

### 現状のコスト
- Gemini: 無料枠（2リクエスト/分制限）
- KLING: Cookie認証（無料）

---

## 目標

**若者が興味を引く、面白いニュース動画**を実現する

### コンセプト
- キャスター無し（リップシンクの品質問題を回避）
- AIがニュースを若者向けに面白く編集（嘘は入れない）
- 内容に合った高品質な画像/映像で視聴者を惹きつける

---

## 提案アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│  1. ニュース取得                                             │
│     - RSS / スクレイピング（既存処理）                        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  2. AI編集（NEW）                                            │
│     - 若者向けに面白く書き換え                                │
│     - 事実は変えない、表現をキャッチーに                       │
│     - 「なぜ重要か」「ツッコミどころ」を強調                    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  3. 画像生成（改善）                                         │
│     - Gemini → Flux Pro に変更                              │
│     - ニュース内容に合った具体的なビジュアル                   │
│     - ニュース映像風の構図                                    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  4. グラフィック合成                                         │
│     - NEWS ALERT / LIVE バッジ                              │
│     - ローワーサード（ヘッドライン）                          │
│     - テンプレートをオーバーレイ                              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  5. 動画生成 + ナレーション（既存 + Phase 2 で改善）          │
│     - KLING or Luma（Phase 2）                              │
│     - ElevenLabs ナレーション（既存）                        │
└─────────────────────────────────────────────────────────────┘
```

---

## AI編集の要件

### 入力
- 元のニュース記事（タイトル + 本文）

### 出力
- 若者向けに編集されたスクリプト

### 編集ルール
1. **事実は変えない**（嘘・誇張禁止）
2. **キャッチーな導入**（「え、マジで？」感を出す）
3. **カジュアルな表現**（堅い報道調→会話調）
4. **「なぜ重要か」を追加**（若者の生活との関連性）
5. **ツッコミポイントの強調**（炎上ではなく笑い）
6. **短く簡潔に**（60-90秒で読める長さ）

### 例
**Before（元記事）:**
> 国土交通省は26日、首都高速道路の一部区間で料金改定を行うと発表した。

**After（AI編集）:**
> 首都高、また値上げするってよ。
> しかも「混んでる時間は高くします」って、通勤で使ってる人完全に狙い撃ちじゃん。
> 国交省いわく「渋滞緩和のため」らしいけど、いや値上げじゃなくて電車なんとかしてくれ。

---

## 実装タスク

### Phase 1: 画像生成改善（今回のスコープ）

#### 1.1 AI編集機能の追加
- [ ] `src/generators/news_rewriter.py` 新規作成
- [ ] Gemini でニュースを若者向けに編集
- [ ] 編集ルールをプロンプトに組み込み
- [ ] ファクトチェック用の元記事保持

#### 1.2 画像生成サービスの変更
- [ ] Gemini Image → Flux Pro に移行
- [ ] `src/generators/image_generator.py` の修正
- [ ] Flux API クライアント実装

#### 1.3 プロンプト生成ロジックの改善
- [ ] `src/generators/content_planner.py` の修正
- [ ] 編集後スクリプトからビジュアル指示を生成
- [ ] ニュース映像風の構図指定

#### 1.4 グラフィックテンプレート作成
- [ ] NEWS バッジ PNG
- [ ] ローワーサード PNG
- [ ] Pillow での合成処理実装

### Phase 2: 動画生成改善（次回スコープ）
- KLING → Luma 等の検討
- 要件は別途詰める

---

## サービス選定

### 画像生成：Flux Pro 1.1（fal.ai 経由）を採用

#### 選定理由
1. **クオリティ**: Artificial Analysis ベンチマーク最高スコア
2. **写実性**: ニュース映像風に最適（Midjourney はアート寄りで不向き）
3. **プロンプト忠実度**: 指示通りの画像が出やすい
4. **速度**: 前世代の6倍速、パイプラインのボトルネックになりにくい
5. **API**: fal.ai 経由でシンプルな REST API

#### 料金体系（fal.ai）

| 解像度 | メガピクセル | 料金/枚 |
|--------|-------------|---------|
| 1024×1024 | ~1 MP | $0.04 |
| 1920×1080 | ~2 MP | $0.08 |
| 512×512 | ~0.25 MP | $0.04（最低） |

#### 他サービスとの比較

| | Flux Pro | DALL-E 3 | Midjourney |
|---|---|---|---|
| クオリティ | ◎ | ○ | ◎ |
| 写実性 | ◎ | ○ | △（アート寄り） |
| API | 公式 | 公式 | 非公式 |
| コスト | $0.04/MP | $0.04/枚 | $10/月定額 |
| 速度 | 速い | 普通 | 遅め |
| ニュース向き | ◎ | ○ | △ |

### 月額コスト見積もり
- 予算: $10/月
- 生成可能枚数:
  - 1024×1024: 約 **250枚/月**
  - 1920×1080: 約 **125枚/月**
- ※キャスター方式と比べてコスト削減（HeyGen/D-ID 不要）

### API 情報
- **プロバイダ**: fal.ai
- **エンドポイント**: `fal-ai/flux-pro/v1.1`
- **ドキュメント**: https://fal.ai/models/fal-ai/flux-pro/v1.1
- **認証**: API キー（https://fal.ai/login で取得）

---

## 見送り事項

### キャスター方式
- **理由:** リップシンクの品質がまだ微妙（不気味の谷問題）
- **代替:** コンテンツ自体を面白くすることで集客
- **将来:** リップシンク技術が向上したら再検討

---

## Phase 2: 動画生成改善（画像改善後に再評価）

### 現状の動画生成方式

| 方式 | ファイル | 品質 | 安定性 | コスト |
|------|----------|------|--------|--------|
| KLING AI | `video_generator.py` | ○ | △（Cookie認証） | 無料 |
| Veo 3.1 | `veo_video_generator.py` | ○〜◎ | ○ | Gemini枠内 |
| Ken Burns | `video_animator.py` | △ | ◎ | 無料 |

### 現状の評価
- Veo 3.1 は凝ったプロンプト設計済み（カテゴリ別動的プロンプト）
- KLING は Cookie 認証で不安定
- Ken Burns は「静止画動かしてる感」が出る

### 方針
**画像を Flux で改善後、動画品質を再評価してからサービス変更を判断**

理由:
- 元画像が改善されれば Veo 3.1 の出力も改善される可能性
- 画像改善の効果を確認してから判断した方が無駄がない

### 検討中のサービス（Phase 2 で再評価）

| サービス | 品質 | コスト | 特徴 |
|----------|------|--------|------|
| **Luma Dream Machine** | ◎ | 無料枠 / $10〜 | Image-to-Video 得意 |
| Runway Gen-3 | ◎ | $15〜/月 | 業界最高峰 |
| Minimax (Hailuo) | ○ | 無料枠あり | 中国発、コスパ良 |
| Veo 3.1 (現状維持) | ○ | Gemini枠 | 既に実装済み |

### Phase 2 のトリガー
- Phase 1（画像改善）完了後
- 改善後の動画出力を確認
- まだ品質不足なら動画サービス変更を検討

---

## トレンドニュース取得の改善

### 背景
- バズってるニュースの方が再生数伸びやすい
- 現状は RSS ベースで、話題性の判断が弱い

### 現状のトレンド検知（既存）
- Google Trends
- Yahoo!/NHK RSS

### 追加候補

| ソース | 取得方法 | コスト | 信頼性 | 採用 |
|--------|----------|--------|--------|------|
| X (Twitter) API | 公式API | $100/月〜 | ◎ | ❌ 高い |
| X スクレイピング | 非公式 | 無料 | △ | ❌ 壊れやすい |
| Google Trends | 既存 | 無料 | ○ | ✅ 継続 |
| Yahoo!リアルタイム検索 | スクレイピング | 無料 | ○ | ✅ 追加推奨 |
| Reddit | API | 無料枠あり | ○ | ❌ 日本ネタ少 |

### 推奨：Yahoo!リアルタイム検索の追加
- X のトレンドとほぼ同じ内容が見れる
- 無料
- 日本向けに最適化
- スクレイピングで取得可能

### 改善後のフロー
```
Yahoo!リアルタイム検索（トレンドワード取得）
    ↓
そのワードでニュース記事を検索
    ↓
AI編集 → 画像生成 → 動画生成
```

### 実装タスク
- [ ] `src/utils/yahoo_realtime.py` 新規作成
- [ ] Yahoo!リアルタイム検索のスクレイピング実装
- [ ] トレンドワード → ニュース記事の紐付けロジック
- [ ] `trend_detector.py` との統合

---

## 次のアクション

1. [ ] Flux Pro の API キー取得
2. [ ] AI編集のプロンプト設計
3. [ ] サンプルニュースでAI編集のテスト
4. [ ] グラフィックテンプレートのデザイン決定
5. [ ] Yahoo!リアルタイム検索のスクレイピング調査

---

## 備考

- 動画生成（KLING → Luma等）は Phase 2 で対応
- ナレーションは既存の ElevenLabs 処理を継続使用
